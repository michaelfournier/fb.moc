var Blog=function(){var e={init:function(){}};return e.Models={},e.Collections={},e.Views={},e.Router={},e}(),Blog=function(e){return e.Models.Bio=Backbone.Model.extend({query:function(e){return this.urlRoot=wp_vars.blogurl+"/api/get_post?post_type=bio&custom_fields=_pinfosbio_fileurl&include=id,content,title,slug,custom_fields&slug="+e,this},initialize:function(){console.log("Bio Model Constructor"),this.bind("error",function(e,t){console.log(t)})}}),e.Collections.BioList=Backbone.Collection.extend({model:e.Models.Bio,all:function(){return this.url=wp_vars.blogurl+"/api/Mikictrl/get_custom_posts?post_type=bio&include=,d,auteurs,title,slug,type&order=asc",this},parse:function(e){return e.posts},initialize:function(){console.log("Biolist collection construite"),this.bind("reset",function(e){console.log(e)})}}),e}(Blog),Blog=function(e){return e.Models.HomePic=Backbone.Model.extend({initialize:function(){console.log("Home Model Constructor"),this.bind("error",function(e,t){console.log(t)})}}),e.Collections.HomePicslist=Backbone.Collection.extend({model:e.Models.HomePic,url:wp_vars.blogurl+"/api/get_page?slug=home&include=attachments",parse:function(e){return e.page.attachments},initialize:function(){console.log("homepage collection construite")}}),e}(Blog),Blog=function(e){return e.Models.MenuElt=Backbone.Model.extend({defaults:{id:"?",url:"?",slug:"?"}}),e.Collections.MenuList=Backbone.Collection.extend({model:e.Models.MenuElt,url:wp_vars.blogurl+"/api/get_page_index?include=id,url,slug",parse:function(e){return e.pages},initialize:function(){console.log("Menu Collection Constructor"),this.bind("error",function(e,t){console.log(t)})}}),e}(Blog),Blog=function(e){return e.Models.News=Backbone.Model.extend({query:function(){return this.urlRoot=wp_vars.blogurl+"/api/get_post?post_type=page&include=id,content,title,slug&slug=home",this},parse:function(e){return e.post?e.post:e},initialize:function(){console.log("news Model Constructor"),this.bind("error",function(e,t){console.log(t)})}}),e}(Blog),Blog=function(e){return e.Models.Notice=Backbone.Model.extend({query:function(){return this.urlRoot=wp_vars.blogurl+"/api/get_post?post_type=page&include=id,content,title,slug&slug=notice",this},parse:function(e){return e.post?e.post:e},initialize:function(){console.log("Notice Model Constructor"),this.bind("error",function(e,t){console.log(t)})}}),e}(Blog),Blog=function(e){return e.Models.Picture=Backbone.Model.extend({initialize:function(){console.log("Picture Model Constructor"),this.bind("error",function(e,t){console.log(t)})}}),e.Collections.PicturesGallery=Backbone.Collection.extend({model:e.Models.Picture,initialize:function(){console.log("PicturesGallery collection construite")}}),e.Models.Video=Backbone.Model.extend({query:function(e){return this.urlRoot="http://vimeo.com/api/oembed.json?url="+encodeURIComponent(e)+"&portrait=0&title=0&byline=0",this},initialize:function(){console.log("Video Model Constructor"),this.bind("error",function(e,t){console.log(t)})}}),e.Collections.VideosGallery=Backbone.Collection.extend({model:e.Models.Video,initialize:function(){console.log("VideosGallery collection construite")}}),e}(Blog),Blog=function(e){return e.Models.Texte=Backbone.Model.extend({query:function(e){return this.urlRoot=wp_vars.blogurl+"/api/get_post?post_type=texts&custom_fields=_pinfostextes_fileurl&include=id,content,title,slug,custom_fields&slug="+e,this},initialize:function(){console.log("Texte Model Constructor"),this.bind("error",function(e,t){console.log(t)})}}),e.Collections.TextesList=Backbone.Collection.extend({model:e.Models.Texte,all:function(){return this.url=wp_vars.blogurl+"/api/Mikictrl/get_custom_posts?post_type=texts&custom_fields=_pinfostextes_sortname&include=custom_fields,id,auteurs,title,slug,type&key=_pinfostextes_sortname&order=asc",this},parse:function(e){return e.posts},initialize:function(){console.log("TextesList collection construite"),this.bind("reset",function(e){console.log(e)})}}),e}(Blog),Blog=function(e){return e.Models.Work=Backbone.Model.extend({query:function(e){return this.urlRoot=wp_vars.blogurl+"/api/get_post?post_type=works&custom_fields=_pmediagallery_blocspics,_pinfos_annee,_pinfos_description&include=id,categories,content,custom_fields,title,id&slug="+e,this},initialize:function(){console.log("Work Model Constructor"),this.bind("error",function(e,t){console.log(t)})}}),e.Collections.WorksList=Backbone.Collection.extend({model:e.Models.Work,all:function(){return this.url=wp_vars.blogurl+"/api/Mikictrl/get_custom_posts?post_type=works&key=_pinfos_annee&custom_fields=_pinfos_annee,_pinfos_description&order=desc&include=id,title,categories,content,gallery,custom_fields,slug&count=-1",this},query:function(){return this.url="/works/"+query,this},parse:function(e){return e.posts},sortByCat:function(){this.comparator=function(e){return[e.get("categories")[0].slug,e.get("slug")]},this.sortkey="categories",this.sort(),console.log(this.models)},sortByDate:function(){this.comparator=function(e,t){var i=e;return e=t,t=i,e.get("custom_fields")._pinfos_annee<t.get("custom_fields")._pinfos_annee?-1:e.get("custom_fields")._pinfos_annee>t.get("custom_fields")._pinfos_annee?1:e.get("slug")<t.get("slug")?1:e.get("slug")>t.get("slug")?-1:0},this.sortkey="annees",this.sort()},initialize:function(){this.sortkey="annees",this.displaymode="thumbs",console.log("WorksList collection construite"),this.bind("reset",function(e){console.log(e)})}}),e}(Blog),Blog=function(e){return e.Views.BaseView=Backbone.View.extend({renderNested:function(e,t,i,o){var l=i instanceof $?i:e.find(i);t.setElement(l).render(o)}}),e}(Blog),Blog=function(e){return e.Views.BioMainView=e.Views.BaseView.extend({el:$("#mainbb"),initialize:function(){this.template=_.template($("#bio_template").html()),_.bindAll(this,"render")},render:function(){console.log("rrr",this),this.$el.html(this.template());var t=this.renderNested,i=this.$el,o=this,l=new e.Views.TextesSidebarView(Blog.mybiolist);return this.mybiosidebarview=l,console.log("to",l.el),Blog.mybiolist.all().fetch({update:!0,success:function(e){t(i,l,"#sidebar",e),o.renderText()}}),Blog.myapprouter.myheight(),this},renderText:function(t){var i=this.$el,o=this.renderNested;t?slug=t:(slug=Blog.mybiolist.at(0).get("slug"),Blog.mybiolist.slug=slug);var l=new e.Views.TextesContentView(Blog.mybio);return Blog.mybio.query(slug).fetch({update:!0,success:function(e){console.log(e),o(i,l,".maincontent",e)}}),this}}),e}(Blog),Blog=function(e){return e.Views.BioView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.model=e,this.template=_.template($("#bio_template").html())},render:function(){console.log(this.model);var e=this.template({mybio:this.model});this.$el.html(e).find(".bio").css("opacity",0),Blog.myapprouter.myheight();var t=this.$el.find("#txtwrapper");return t.mCustomScrollbar("destroy"),t.hasClass("mCustomScrollbar")||t.mCustomScrollbar({set_height:"100%",scrollInertia:150,theme:"dark"}),this.$el.find(".bio").animate({opacity:1},{duration:500,complete:function(){}}),this}}),e}(Blog),Blog=function(e){return e.Views.HomeView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.collection=e},render:function(){var e=[];_.each(this.collection.models,function(t){e.push(t.get("images").full.url)}),$.backstretch(_.shuffle(e),{duration:4e3,fade:2050})}}),e}(Blog),Blog=function(e){return e.Views.MainWorksView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.model=e,this.template=_.template($("#mainworks_template").html()),_.bindAll(this,"render")},render:function(){var e=this.template();return this.$el.html(e),this}}),e}(Blog),Blog=function(e){return e.Views.MenuView=Backbone.View.extend({el:$("#blog_mainmenu"),initialize:function(){this.template=$("#blog_mainmenu_template").html()},render:function(){var e=Mustache.to_html(this.template,{posts:this.collection.toJSON()});this.$el.html(e)}}),e}(Blog),Blog=function(e){return e.Views.NewsView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.model=e,this.template=_.template($("#news_template").html())},render:function(){console.log(this.model),this.$el.html("");var e=this.template({mynews:this.model});this.$el.html(e).find("#txtwrapper").css("opacity",0),this.$el.find("#txtwrapper").animate({opacity:1},{duration:300,complete:function(){}})},events:{"click #btn-close":"closeWindow"},closeWindow:function(e){$(e.currentTarget).parent().remove()}}),e}(Blog),Blog=function(e){return e.Views.NoticeView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.model=e,this.template=_.template($("#notice_template").html())},render:function(){console.log(this.model);var e=this.template({mynotice:this.model});this.$el.html(e).find("#txtwrapper").css("opacity",0),Blog.myapprouter.myheight();var t=this.$el.find("#txtwrapper");t.mCustomScrollbar("destroy"),t.hasClass("mCustomScrollbar")||t.mCustomScrollbar({set_height:"100%",scrollInertia:150,theme:"dark"}),this.$el.find("#txtwrapper").animate({opacity:1},{duration:300,complete:function(){}})}}),e}(Blog),Blog=function(e){return e.Views.PictureSingleView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.model=e,this.template=_.template($("#picturesingle_template").html())},render:function(){var e=this.template({mypicture:this.model});this.$el.find(".maincontent").html(e).find("img").css("display","none"),$(".maincontent").imagesLoaded(function(){Blog.myapprouter.myheight(),$(this).find("#sidebar").mCustomScrollbar("update"),$(this).find("img").fadeIn(500)})}}),e}(Blog),Blog=function(e){return e.Views.PictureView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.model=e,this.template=_.template($("#picture_template").html())},render:function(){var e=this.template({mypicture:this.model}),t=this.$el.find("#picture"),i=this;this.$el.find(".maincontent img").length>0?this.$el.find(".maincontent img").fadeOut(300,function(){t.html(e).find("img").css("display","none"),i.showOnLoaded()}):(t.html(e).find("img").css("display","none"),this.showOnLoaded())},showOnLoaded:function(){$(".maincontent").imagesLoaded(function(){Blog.myapprouter.myheight(),$(this).parent().find("#sidebar").mCustomScrollbar("update"),$(this).find("img").fadeIn(400)})}}),e}(Blog),Blog=function(e){return e.Views.PicturesGalNavView=Backbone.View.extend({el:$("#mainbb"),initialize:function(t){this.collection=t,this.template=_.template($("#navgallery_template").html()),this.idpic=0,Blog.mypicture=new e.Models.Picture,Blog.mypicturesingleview=new e.Views.PictureSingleView(Blog.mypicture),Blog.mypictureview=new e.Views.PictureView(Blog.mypicture)},render:function(){var e=this.template({gallery:this.collection.models});return this.gallerylength=this.collection.models.length,i=1,this.$el.find("#navgal").remove(),this.$el.find(".maincontent").append(e).find("a").each(function(){$(this).delay(150*i).fadeIn(),i++}),this.showpicture(0),this},events:{"click a.btn-picture":"nextpicture","click a.linkpic":"linktopic"},showpicture:function(e){Blog.mypicture.set(this.collection.models[e].toJSON()),Blog.mypictureview.render(),this.activelink(),this.idpic++},showsinglepicture:function(){Blog.mypicture.set(this.collection.models[0].toJSON()),Blog.mypicturesingleview.render()},activelink:function(){this.$el.find("#navgal a").removeClass("actif"),this.$el.find("#navgal a[data-bypass|="+this.idpic+"]").addClass("actif")},linktopic:function(e){index=e.currentTarget.attributes["data-bypass"].value,this.idpic=index,this.showpicture(index)},nextpicture:function(e){console.log(e),i=this.idpic,i>this.gallerylength-1?this.$el.find("#nextwork a").click():(this.showpicture,this.showpicture(i))}}),e}(Blog),Blog=function(e){return e.Views.SidebarWorksView=Backbone.View.extend({el:$("#mainbb"),initialize:function(){this.template=_.template($("#sidebar_works_template").html()),_.bindAll(this,"render")},render:function(){var e=this.template();return this.$el.append(e),this}}),e}(Blog),Blog=function(e){return e.Views.TextesContentView=Backbone.View.extend({initialize:function(e){this.template=_.template($("#content_texts_template").html()),_.bindAll(this,"render"),this.model=e,console.log(this.model)},render:function(){var e=this.$el,t=this.template({texte:this.model});return this.$el.animate({opacity:0},{duration:100,complete:function(){$(e).html(t);var i=$(e).find("#txtwrapper");i.mCustomScrollbar("destroy"),i.hasClass("mCustomScrollbar")||i.mCustomScrollbar({set_height:"100%",scrollInertia:150,theme:"dark"}),Blog.myapprouter.myheight(),i.mCustomScrollbar("update"),$(e).animate({opacity:1},{duration:500})}}),this}}),e}(Blog),Blog=function(e){return e.Views.TextesMainView=e.Views.BaseView.extend({el:$("#mainbb"),initialize:function(){this.template=_.template($("#maintexts_template").html()),_.bindAll(this,"render")},render:function(){this.$el.html(this.template());var t=this.renderNested,i=this.$el;if(void 0===o){var o=new e.Views.TextesSidebarView(Blog.mytexteslist);Blog.mytexteslist.all().fetch({success:function(e){t(i,o,"#sidebar",e)}})}return Blog.myapprouter.myheight(),this},renderText:function(t){var i=this.$el,o=this.renderNested;slug=t,this.mytextscontentview=new e.Views.TextesContentView(Blog.mytexte);var l=this.mytextscontentview;return Blog.mytexte.query(slug).fetch({success:function(e){o(i,l,".maincontent",e)}}),this}}),e}(Blog),Blog=function(e){return e.Views.TextesSidebarView=Backbone.View.extend({initialize:function(e){this.template=_.template($("#sidebar_texts_template").html()),_.bindAll(this,"render"),this.collection=e},render:function(){this.collection.slug||(this.collection.slug=this.collection.at(0).get("slug"));var e=this.template({textes:this.collection.models,slug:this.collection.slug});return i=1,this.$el.html(e).find("a").each(function(){$(this).delay(50*i).animate({opacity:1}),i++}),sidebar=this.$el,sidebar.hasClass("mCustomScrollbar")||sidebar.mCustomScrollbar({set_height:"100%",scrollInertia:150,theme:"dark"}),sidebar.mCustomScrollbar("update"),this},showactif:function(e){this.$el.find("h3").removeClass("actif"),$(e.currentTarget).find("h3").addClass("actif")},events:{"click #sidebarwrapper a":"showactif"}}),e}(Blog),Blog=function(e){return e.Views.VideoView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.model=e,this.template=_.template($("#video_template").html())},render:function(){console.log(this.model);var e=this.template({myvideo:this.model});Blog.myapprouter.myheight(),this.$el.find("#sidebar").mCustomScrollbar("update"),this.$el.find(".maincontent").html(e)}}),e}(Blog),Blog=function(e){return e.Views.VideosGalNavView=Backbone.View.extend({el:$("#mainbb"),initialize:function(t){this.collection=t,this.template=_.template($("#navgalleryvid_template").html()),this.template_video=_.template($("#video_template").html()),Blog.myvideo=new e.Models.Video,Blog.myvideoview=new e.Views.VideoView(Blog.myvideo),this.idpic=0},render:function(){var e=this.template({gallery:this.collection.models});return this.gallerylength=this.collection.models.length,i=1,this.$el.find("#navgal").empty(),this.collection.models.length>1?(this.$el.find("#navgal").html(e).find("a").each(function(){$(this).delay(150*i).fadeIn(),i++}),this.showvideo(0)):this.showvideo(0),this},events:{"click a.linkvid":"linktovid"},showvideo:function(e){videourl=this.collection.models[e].get("videourl"),this.idpic,Blog.myvideo.query(videourl).fetch({update:!0,success:function(e){console.log(e),Blog.myvideoview.render(e)}}),this.activelink()},activelink:function(){this.$el.find("#navgal a").removeClass("actif"),this.$el.find("#navgal a[data-bypass|="+this.idpic+"]").addClass("actif")},linktovid:function(e){index=e.currentTarget.attributes["data-bypass"].value,this.idpic=index,this.showvideo(index)}}),e}(Blog),Blog=function(e){return e.Views.WorkMainView=e.Views.BaseView.extend({el:$("#mainbb"),initialize:function(e){this.model=e,this.template=_.template($("#mainworks_template").html()),_.bindAll(this,"render")},render:function(){this.renderWorksListMini();var e=this.template();return this.$el.html(e),this},renderWork:function(t){Blog.myworkslist.all().fetch({update:!0,success:function(i){Blog.myworkslist.workslug=t,myworkid=i.where({slug:t})[0].id,Blog.mywork=Blog.myworkslist.get(myworkid);var o=new e.Views.WorkView(Blog.mywork);o.undelegateEvents(),o.render(Blog.mywork),o.delegateEvents()}})},renderWorksListMini:function(){var t=this.$el,i=this.renderNested,o=new e.Views.WorksListMiniView(Blog.myworkslist);return Blog.myworkslist.all().fetch({update:!0,success:function(e){i(t,o,"#tools",e),console.log("list done")}}),this}}),e}(Blog),Blog=function(e){return e.Views.WorkSidebarView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.model=e,this.template=_.template($("#sidebar_works_template").html())},render:function(){var e=this.template({work:this.model});return this.$el.html(e),sidebar=this.$el,sidebar.mCustomScrollbar({set_height:"100%",scrollInertia:150,theme:"dark"}),this}}),e}(Blog),Blog=function(e){return e.Views.WorkView=e.Views.BaseView.extend({el:$("#mainbb"),initialize:function(e){this.template=_.template($("#mainworks_template").html()),this.i=0;var t=e;this.model=t},renderPictures:function(){this.$el,this.renderNested,this.$el.find("#picvidswitcher a").removeClass("actif"),this.$el.find("#picvidswitcher #images").addClass("actif"),Blog.picturesgalview&&Blog.picturesgalview.undelegateEvents();var t=new e.Collections.PicturesGallery(this.model.get("gallery"));Blog.picturesgalview=new e.Views.PicturesGalNavView(t),Blog.picturesgalview.render()},renderVideos:function(){this.$el,this.renderNested,Blog.videosgalview&&Blog.videosgalview.undelegateEvents(),this.$el.find("#picvidswitcher a").removeClass("actif"),this.$el.find("#picvidswitcher #videos").addClass("actif");var t=new e.Collections.VideosGallery(Blog.mywork.get("galleryvideos"));Blog.videosgalview=new e.Views.VideosGalNavView(t),Blog.videosgalview.render()},picvidswitcher:function(e,t){e>0&&t>0?($("#picvidswitcher").html('<ul><li><a id="images" href="#" data-bypass>images('+e+')</a></li><li><a id="videos" href="#" data-bypass>vidéos('+t+")</a></li></ul>"),this.renderPictures()):t>0&&0===e?this.renderVideos():e>0&&0===t&&this.renderPictures()},renderSidebar:function(){var t=this.$el,i=this.renderNested,o=new e.Views.WorkSidebarView(this.model);i(t,o,"#sidebar",this.model)},render:function(){this.showactif(this.model.get("slug")),this.model;var e,t;e=this.model.get("gallery")?this.model.get("gallery").length:0,t=this.model.get("galleryvideos")?this.model.get("galleryvideos").length:0,Blog.myworkslist&&this.nextwork();var i=this;return this.$el.find("#wrapper").fadeOut("fast",function(){i.renderSidebar(),$(this).hasClass("mCustomScrollbar")&&$(this).mCustomScrollbar("destroy"),$(this).css({"overflow-y":"hidden"}),$(this).find(".maincontent").empty(),$(this).find(".maincontent").css({"overflow-y":"hidden"}),$(this).fadeIn("fast",function(){i.picvidswitcher(e,t)})}),this},scrolltonextprev:function(e){slug=$(e.currentTarget).attr("data-slug"),this.$el.find("#"+slug),this.$el.find("#workslistmini").mCustomScrollbar("scrollTo","#"+slug,{callbacks:this.showactif(slug)}),this.undelegateEvents()},showactif:function(e){item=this.$el.find("#"+e),this.$el.find(".jTscroller a").removeClass("actif"),item.addClass("actif")},nextwork:function(){var e=this.collection.indexOf(this.model),t=this.collection.length-1;nextmodel=this.collection.at(e+1),prevmodel=this.collection.at(e-1),slugprev=prevmodel?prevmodel.get("slug"):this.collection.at(t).get("slug"),prevhref="#works/"+slugprev,slugnext=nextmodel?nextmodel.get("slug"):this.collection.at(0).get("slug"),nexthref="#works/"+slugnext,console.log(this.$el.find("#nextwork").find("a")),this.$el.find("#nextwork").find("a").attr({href:nexthref,"data-slug":slugnext}),this.$el.find("#prevwork").find("a").attr({href:prevhref,"data-slug":slugprev})},events:{"click .nextprevworks a":"scrolltonextprev","click a#videos":"renderVideos","click a#images":"renderPictures"}}),e}(Blog),Blog=function(e){return e.Views.WorksListMainView=e.Views.BaseView.extend({el:$("#mainbb"),initialize:function(e){this.model=e,this.template=_.template($("#workslistmain_template").html()),_.bindAll(this,"render")},render:function(){var e=this.template();return this.$el.html(e),this.renderWorksList(),this},renderWorksList:function(){var t=this.$el,i=this.renderNested;Blog.myworkslistview||(Blog.myworkslistview=new e.Views.WorksListView(Blog.myworkslist));var o=Blog.myworkslistview,l=new e.Views.WorksListToolsView;return Blog.myworkslist.all().fetch({success:function(e){console.log(e),i(t,o,".maincontent_index",e),i(t,l,"#tools"),Blog.myapprouter.myheight()}}),this},events:{"click #sortbydate":"sortbydate","click #sortbycat":"sortbycat","click #displaylist":"displaylist","click #displaythumb":"displaythumb"},sortbycat:function(e){$("#sorting a").removeClass("actif"),$(e.currentTarget).addClass("actif"),Blog.myworkslist.sortByCat()},sortbydate:function(e){$("#sorting a").removeClass("actif"),$(e.currentTarget).addClass("actif"),Blog.myworkslist.sortByDate()},displaylist:function(e){$("#displaying a").removeClass("actif"),$(e.currentTarget).addClass("actif"),Blog.myworkslistview.template=Blog.myworkslistview.templatelist,Blog.myworkslist.displaymode="list",Blog.myworkslistview.render(),this.$el.find("#sorting").css("display","block")},displaythumb:function(e){$("#displaying a").removeClass("actif"),$(e.currentTarget).addClass("actif"),Blog.myworkslistview.template=Blog.myworkslistview.templatethumb,Blog.myworkslist.displaymode="thumbs",Blog.myworkslistview.render(),Blog.myworkslist.sortByDate(),this.$el.find("#sorting a").removeClass("actif"),this.$el.find("#sortbydate").addClass("actif"),this.$el.find("#sorting").css("display","none")},myheight:function(){var e=$("#mainbb").offset(),t=e.top,i=$(window).height()-(t+$("#main_header").height()+40);$("#wrapper").css("height",i),console.log(i)}}),e}(Blog),Blog=function(e){return e.Views.WorksListMiniView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.collection=e,this.template=_.template($("#works_listmini_template").html()),_.bindAll(this,"render")},render:function(){var e=this.template({works:this.collection.models,sortkey:this.collection.sortkey});i=1,this.$el.append(e),this.$el.find("#unfoldworks").css("display","block");var t=this.$el.find("#workslistmini");return t.imagesLoaded(function(){t.imagesLoaded(function(){$(this).thumbnailScroller({scrollerType:"hoverPrecise",scrollerOrientation:"vertical",acceleration:4,scrollSpeed:800,noScrollCenterSpace:1})}),t.hasClass("mCustomScrollbar")||t.mCustomScrollbar({set_height:"100%",scrollInertia:150,autoDraggerLength:!1,theme:"dark"}),t.mCustomScrollbar("update")}),this},events:{"click #unfoldworks a":"toggleworks"},scrolltoactive:function(){var e=this.$el.find("#"+this.collection.workslug);console.log(e),this.$el.find("#workslistmini").mCustomScrollbar("update"),this.$el.find("#workslistmini").mCustomScrollbar("scrollTo","#"+this.collection.workslug,{callbacks:this.showactif(e)})},showactif:function(e){this.$el.find(".jTscroller a").removeClass("actif"),e.addClass("actif")},toggleworks:function(e){elt=this.$el.find("#workslistmini"),0>=elt.width()?(elt.animate({width:"260px",complete:this.scrolltoactive()},150),$(e.currentTarget).addClass("fold")):(this.$el.find("#sidebar").css("display","none"),elt.animate({width:0},150),$(e.currentTarget).removeClass("fold"))}}),e}(Blog),Blog=function(e){return e.Views.WorksListToolsView=Backbone.View.extend({el:$("#mainbb"),initialize:function(e){this.collection=e,this.template=_.template($("#workslisttools_template").html())},render:function(){var e=this.template({sortkey:Blog.myworkslist.sortkey,displaymode:Blog.myworkslist.displaymode});return this.$el.html(e),this}}),e}(Blog),Blog=function(e){return e.Views.WorksListView=Backbone.View.extend({initialize:function(e){this.collection=e,this.templatethumb=_.template($("#works_list_template_thumb").html()),this.templatelist=_.template($("#works_list_template_list").html()),this.template=this.templatethumb,this.collection.bind("sort",this.render,this)},render:function(){var e=this.template({works:this.collection.models,sortkey:this.collection.sortkey});return i=1,this.$el.removeAttr("style").html(e).find(".wrapthumb").each(function(){$(this).delay(80*i).animate({opacity:1}),i++}),wrapper=this.$el,wrapper.hasClass("mCustomScrollbar")?(wrapper.mCustomScrollbar("destroy"),wrapper.mCustomScrollbar({set_height:"100%",scrollInertia:150,theme:"dark"})):wrapper.mCustomScrollbar({set_height:"100%",scrollInertia:150,theme:"dark"}),Blog.myapprouter.myheight(),wrapper.mCustomScrollbar("update"),this},showInfos:function(e){myid=$(e.currentTarget).attr("data-id"),this.$el.parent().find("#sidebar h3").html(e.currentTarget.title),this.$el.parent().find("#sidebar h4").html(this.collection.get(myid).get("custom_fields")._pinfos_annee[0]),this.$el.parent().find("#sidebar #description").html(this.collection.get(myid).get("custom_fields")._pinfos_description[0])},hideInfos:function(){this.$el.parent().find("#sidebar").children().empty()}}),e}(Blog),Blog=function(e){return e.Router.RoutesManager=Backbone.Router.extend({initialize:function(){Blog.myhomepics=new e.Collections.HomePicslist,Blog.myworkslist=new e.Collections.WorksList,Blog.mywork=new e.Models.Work,Blog.mytexteslist=new e.Collections.TextesList,Blog.mytexte=new e.Models.Texte,Blog.mybiolist=new e.Collections.BioList,Blog.mybio=new e.Models.Bio,Blog.mynews=new e.Models.News,Blog.mynotice=new e.Models.Notice,Blog.currentView=new Backbone.View,this.bind("route",function(e,t){console.log("Different Page: "+e+t)}),$(window).on("resize",_.bind(this.myheight,this)),this.myheight()},routes:{"works/:slug_post":"displayWork",works:"displayWorksList",texts:"displayText","texts/:slug_post":"displayText",bio:"displayBio","bio/:slug_post":"displayBio",notice:"notice",home:"home","":"home","*path":"home"},myheight:function(){var e=$(window).height()-$("#main_header").outerHeight(!0)-$("#tools").outerHeight(!0)-10;$("#wrapper, #workslistmini").css("height",e),imageheight=$("#wrapper figure img").height(),legendheight=$("#wrapper #legend").height(),$("#wrapper").find("#picture img").css("max-height",e-legendheight),console.log(legendheight)},selectMenu:function(e){$("#main_nav a").removeClass("actif"),$('#main_nav a[href="#'+e+'"]').addClass("actif")},root:function(){this.selectMenu(),$("#mainbb").html(""),e.myhomepage.fetch({success:function(e){attachments=e.toJSON();var t=[];_.each(attachments,function(e){t.push(e.url)}),$.backstretch(_.shuffle(t),{duration:4e3,fade:2050})}})},home:function(){this.selectMenu("home"),Blog.homeview||(Blog.homeview=new e.Views.HomeView(Blog.myhomepics)),Blog.newsview||(Blog.newsview=new e.Views.NewsView(Blog.mynews)),Blog.myhomepics.fetch({success:function(e){Blog.homeview.render(e),Blog.currentView=Blog.homeview}}),Blog.mynews.query().fetch({success:function(e){Blog.newsview.render(e)}})},notice:function(){this.selectMenu("notice"),this.killbackstrech(),Blog.noticeview=new e.Views.NoticeView(Blog.mynotice),Blog.mynotice.query().fetch({success:function(e){Blog.noticeview.render(e),Blog.currentView=Blog.noticeview}})},displayWorksList:function(){this.selectMenu("works"),this.killbackstrech(),Blog.mymainworkslistview||(Blog.mymainworkslistview=new e.Views.WorksListMainView),Blog.mymainworkslistview.render(),Blog.currentView=Blog.mymainworkslistview},displayWork:function(t){this.selectMenu("works"),this.killbackstrech(),Blog.mymainworkview||(Blog.mymainworkview=new e.Views.WorkMainView),this.switchView(Blog.mymainworkview),Blog.mymainworkview.renderWork(t)},displayText:function(t){this.selectMenu("texts"),this.killbackstrech(),Blog.textesmainview||(Blog.textesmainview=new e.Views.TextesMainView),t?(Blog.mytexteslist.slug=t,this.switchView(Blog.textesmainview),Blog.textesmainview.renderText(t)):(Blog.mytexteslist.slug="",Blog.textesmainview.render(),Blog.currentView=Blog.textesmainview)},displayBio:function(t){this.selectMenu("bio"),this.killbackstrech(),Blog.biomainview||(Blog.biomainview=new e.Views.BioMainView),t?(Blog.mybiolist.slug=t,this.switchView(Blog.biomainview),Blog.biomainview.renderText(t)):(Blog.mybiolist.slug="",Blog.biomainview.render(),Blog.currentView=Blog.biomainview)},switchView:function(e){e.cid!=Blog.currentView.cid&&(e.render(),Blog.currentView=e)},killbackstrech:function(){$(".backstretch").fadeOut("fast",function(){$(this).remove()})}}),Blog.myapprouter=new e.Router.RoutesManager,myroot="fr"!=wp_vars.lang?wp_vars.lang:"",Backbone.history.start({pushState:!0,root:myroot}),$(document).on("click","a[href]:not([data-bypass])",function(e){var t={prop:$(this).prop("href"),attr:$(this).attr("href")},i=location.protocol+"//"+location.host+"/";t.prop.slice(0,i.length)===i&&($("#qtrans a").attr("href",wp_vars.blogurl+"/"+$(this).attr("href")),e.preventDefault(),Backbone.history.navigate(t.attr,!0))}),e}(Blog);